<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
    <ModulePrefs title="TM TEST"> 
    </ModulePrefs>
    <Content type="html">
    <![CDATA[ 
        <style>
        #all {
        margin: 0px;
        padding: 0px;
        width: 941px;
        height: 100%;
        }
        #apviaapps_parts {
        float: left;
        margin: 0px;
        padding: 0px;
        width: 160px;
        height: 100%;
        background: #aaaaaa;
        }
        #content_canvas {
        float: left;
        font-size: 12px;
        margin: 0px;
        padding: 0px;
        color:#444444;
        width: 781px;
        }
        </style>
        <div id="content-div"></div>
        <script type="text/javascript">
            var view = document.getElementById( 'content-div' );
            function request (form){    
                view.innerHTML = '';
                var params = {};
                var ts = (new Date()).getTime();
                params[ gadgets.io.RequestParameters.CONTENT_TYPE ] = gadgets.io.ContentType.JSON;
                // params[ gadgets.io.RequestParameters.METHOD ] = gadgets.io.MethodType.GET;
                params[ gadgets.io.RequestParameters.REFRESH_INTERVAL ] = 0;  // does this work?
                if(form){
				  var req_url = "http://www.oedolab.com/te/tm/scr.php?url=" + encodeURIComponent(form.url.value);
				}else{
					alert("URLを指定してね");
					return;
				}
                gadgets.io.makeRequest( req_url, callback, params );
            };
            function callback ( obj ){
                var html = "";
                for( var i=0; i<obj.data.length; i++ ){
                    var row = obj.data[i];
                    html += '<table width="150" style="float:left">' ;
                    html += '<tr><td align="center" valign="middle" height="147">';
                    html += '<a href="' + row.url + '" target="_blank">'
                    html += '<img src="' + row.img + '">';
                    html += "</a>";
                    html += "</td></tr>";
                    html += "<tr><td><strong>" + row.title + "</strong></td></tr>";
                    html += "<tr><td>" + row.desc + "</td></tr>";
                    html += '</table>';
                }
                view.innerHTML = html;
            };
        </script>
        <div style="margin-top:10px;clear:both" >
            <input type="button" value="make API request" onclick="request()"/>
            <form name="frm" action="#" onsubmit="request(this);return false">
	            <input type="text" name="url" id="url" />
            	<input type="submit" value="検索"/>
            </form>
        </div>
    ]]>
    </Content> 
</Module>
